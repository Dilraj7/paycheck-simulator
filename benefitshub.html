<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Benefits Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Public Sans", sans-serif;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="bg-gray-100 min-h-screen text-[#111418]">
    <header class="bg-white shadow-sm p-5 flex items-center justify-between">
      <h1 class="text-2xl font-bold">🎁 Benefits Hub</h1>
      <nav class="space-x-6 text-sm">
        <a href="index.html" class="hover:underline">Accueil</a>
        <a href="dashboard.html" class="hover:underline">Dashboard</a>
        <a href="careersimulator.html" class="hover:underline">Carrière</a>
        <a href="benefitshub.html" class="hover:underline">Avantages</a>
        <a href="salaryinsights.html" class="hover:underline">Salaire</a>
      </nav>
    </header>

    <main class="flex h-screen w-screen overflow-hidden bg-gray-50">
      <section class="w-1/2 overflow-y-auto p-10 bg-white border-r border-gray-200">
        <h2 class="text-2xl font-bold mb-6">📝 Vos informations</h2>

        <!-- Place ici tout ton formulaire : salaire, TR, mutuelle, transport, etc. -->
        <!-- Garde les groupes avec padding et classes Tailwind standard -->

        <div class="bg-white p-10 rounded-2xl shadow w-full">
        <h2 class="text-2xl font-bold mb-4">
          Simulateur d'Avantages Sociaux Personnalisés
        </h2>
        <p class="text-gray-600 mb-6">
          Indiquez les montants mensuels versés (ou remboursés) par votre
          employeur. Les calculs sont faits automatiquement sur une base
          annuelle.
        </p>

        <!-- 🧾 Salaire brut mensuel (référence pour le 13e/14e mois) -->
        <div class="mb-8">
          <label class="block font-medium mb-1"
            >Votre salaire brut mensuel (€)</label
          >
          <input
            type="number"
            id="salaireMensuel"
            placeholder="Ex : 3200"
            class="form-input w-full max-w-sm h-12 border-gray-300 rounded"
          />
        </div>

        <!-- 🎟️ Titres-restaurant -->
        <fieldset
          class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end mb-6 border-t pt-6"
        >
          <legend class="text-lg font-semibold col-span-full mb-2">
            Titres Restaurant
          </legend>
          <div>
            <label class="font-medium block mb-1"
              >Part employeur / mois (€)</label
            >
            <input
              type="number"
              id="trEmployeur"
              placeholder="Ex : 120"
              class="form-input w-full h-12 rounded"
            />
          </div>
          <div>
            <label class="font-medium block mb-1"
              >Part salarié / mois (€)</label
            >
            <input
              type="number"
              id="trSalarie"
              placeholder="Ex : 60"
              class="form-input w-full h-12 rounded"
            />
          </div>
        </fieldset>

        <!-- 🏥 Mutuelle -->
        <fieldset
          class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end mb-6 border-t pt-6"
        >
          <legend class="text-lg font-semibold col-span-full mb-2">
            Mutuelle
          </legend>
          <div>
            <label class="font-medium block mb-1"
              >Part employeur / mois (€)</label
            >
            <input
              type="number"
              id="mutuelleEmployeur"
              placeholder="Ex : 40"
              class="form-input w-full h-12 rounded"
            />
          </div>
          <div>
            <label class="font-medium block mb-1"
              >Part salarié / mois (€)</label
            >
            <input
              type="number"
              id="mutuelleSalarie"
              placeholder="Ex : 40"
              class="form-input w-full h-12 rounded"
            />
          </div>
        </fieldset>

        <!-- 🚆 Transport -->
        <div class="mb-6 border-t pt-6">
          <label class="block font-medium mb-1"
            >Montant remboursé transport / mois (€)</label
          >
          <input
            type="number"
            id="transport"
            placeholder="Ex : 50"
            class="form-input w-full max-w-sm h-12 rounded"
          />
        </div>

        <!-- 💶 13e / 14e mois -->
        <div class="flex items-center gap-6 mb-6 border-t pt-6">
          <label class="flex items-center space-x-2">
            <input
              type="checkbox"
              id="mois13"
              class="form-checkbox accent-blue-600"
            />
            <span>13ᵉ mois</span>
          </label>
          <label class="flex items-center space-x-2">
            <input
              type="checkbox"
              id="mois14"
              class="form-checkbox accent-blue-600"
            />
            <span>14ᵉ mois</span>
          </label>
        </div>
      </section>

      <section class="w-1/2 overflow-y-auto p-10 bg-gray-50">
  <h2 class="text-2xl font-bold mb-6">📊 Résultats</h2>

  <!-- Résultats dynamiques -->
  <div id="resultatsContainer" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-6 mb-8">
    <!-- 🪄 Cartes injectées dynamiquement ici -->
  </div>

  <!-- Résumé total -->
  <div id="recap" class="hidden bg-gradient-to-br from-blue-700 to-sky-500 text-white p-6 rounded-xl shadow mb-10 text-center">
    <h3 class="text-lg font-semibold mb-2">💰 Total estimé</h3>
    <p class="text-3xl font-bold" id="total">-- €</p>
    <p class="text-sm text-blue-100 mt-1">Avantages bruts annuels</p>
  </div>

  <!-- Graphique -->
  <div class="bg-white p-6 rounded-xl shadow">
    <h3 class="text-lg font-semibold mb-4 text-center">📈 Répartition des avantages</h3>
    <canvas id="avantagesChart" class="w-full max-w-lg mx-auto"></canvas>
  </div>
</section>

      

      <script>
        function format(n) {
          return n.toLocaleString("fr-FR", { maximumFractionDigits: 0 });
        }

        function calculAvantages() {
          const salaire = parseFloat(
            document.getElementById("salaireMensuel").value || 0
          );
          const trEmp = parseFloat(
            document.getElementById("trEmployeur").value || 0
          );
          const trSal = parseFloat(
            document.getElementById("trSalarie").value || 0
          );
          /*const mutuelle = parseFloat(
            document.getElementById("mutuelle").value || 0
          );*/
          const transport = parseFloat(
            document.getElementById("transport").value || 0
          );
          const mois13 = document.getElementById("mois13").checked;
          const mois14 = document.getElementById("mois14").checked;

          const container = document.getElementById("resultatsContainer");
          const recap = document.getElementById("recap");
          const totalDisplay = document.getElementById("total");
          container.innerHTML = "";
          let total = 0;

          // 🎟️ Titres-restaurant
          if (trEmp > 0) {
            const joursTravaillés = 220; // en moyenne
            const val = Math.round((trEmp * joursTravaillés) / 20); // basé sur 20 tickets/mois
            total += val;
            let ratio = trEmp / (trEmp + trSal);
            const ratioStr = isFinite(ratio)
              ? Math.round(ratio * 100) + " %"
              : "-";
            container.innerHTML += `
            <div class="bg-blue-50 rounded-xl p-5 shadow-lg text-center hover:scale-[1.02] transition-all duration-300">
              <div class="text-3xl">🍽️</div>
              <p class="text-sm mt-1 font-medium text-blue-800">Titres-restaurant</p>
              <p class="text-xl font-bold text-blue-900">+${format(
                val
              )} € / an</p>
              <p class="text-xs text-gray-500 mt-1">Part employeur : ${ratioStr} – ${format(
              trEmp + trSal
            )} €/mois</p>
            </div>`;
          }

          // 🏥 Mutuelle avec part employeur et salarié
          const mutEmp = parseFloat(
            document.getElementById("mutuelleEmployeur").value || 0
          );
          const mutSal = parseFloat(
            document.getElementById("mutuelleSalarie").value || 0
          );

          if (mutEmp > 0) {
            const annuel = Math.round(mutEmp * 12);
            total += annuel;
            const totalMensuel = mutEmp + mutSal;
            const ratio = mutEmp / (totalMensuel || 1);
            const pourcentage = Math.round(ratio * 100);

            container.innerHTML += `
  <div class="bg-green-50 rounded-xl p-5 shadow-lg text-center hover:scale-[1.02] transition-all duration-300">
    <div class="text-3xl">🏥</div>
    <p class="text-sm mt-1 font-medium text-green-800">Mutuelle</p>
    <p class="text-xl font-bold text-green-900">+${format(annuel)} € / an</p>
    <p class="text-xs text-gray-500 mt-1">Part employeur : ${pourcentage} % – ${format(
              totalMensuel
            )} €/mois</p>
  </div>`;
          }

          // 🚆 Transport
          if (transport > 0) {
            const val = Math.round(transport * 12);
            total += val;
            container.innerHTML += `
  <div class="bg-indigo-50 rounded-xl p-5 shadow-lg text-center hover:scale-[1.02] transition-all duration-300">
    <div class="text-3xl">🚆</div>
    <p class="text-sm mt-1 font-medium text-indigo-800">Transport remboursé</p>
    <p class="text-xl font-bold text-indigo-900">+${format(val)} € / an</p>
  </div>`;
          }

          // 💶 13e / 14e mois
          if ((mois13 || mois14) && salaire > 0) {
            const moisSup = (mois13 ? 1 : 0) + (mois14 ? 1 : 0);
            const val = Math.round(salaire * moisSup);
            total += val;
            container.innerHTML += `
  <div class="bg-yellow-50 rounded-xl p-5 shadow-lg text-center hover:scale-[1.02] transition-all duration-300">
    <div class="text-3xl">💶</div>
    <p class="text-sm mt-1 font-medium text-yellow-800">${
      moisSup === 2 ? "13ᵉ + 14ᵉ mois" : "13ᵉ mois"
    }</p>
    <p class="text-xl font-bold text-yellow-900">+${format(val)} € / an</p>
    <p class="text-xs text-gray-500 mt-1">${moisSup} mois supplémentaires au salaire brut</p>
  </div>`;
          }

          // Résumé final
          if (total > 0) {
            recap.classList.remove("hidden");
            totalDisplay.textContent = format(total) + " €";
          } else {
            recap.classList.add("hidden");
            totalDisplay.textContent = "-- €";
          }

          // 🎯 Construire les données pour le graphique
          const chartData = [];
          const chartLabels = [];
          const chartColors = [];

          if (trEmp > 0) {
            const val = Math.round((trEmp * 220) / 20);
            chartLabels.push("Titres-restaurant");
            chartData.push(val);
            chartColors.push("#3B82F6"); // bleu
          }

          if (mutEmp > 0) {
            const annuel = Math.round(mutEmp * 12);
            chartLabels.push("Mutuelle");
            chartData.push(annuel);
            chartColors.push("#10B981"); // vert
          }

          if (transport > 0) {
            const val = Math.round(transport * 12);
            chartLabels.push("Transport");
            chartData.push(val);
            chartColors.push("#6366F1"); // indigo
          }

          if ((mois13 || mois14) && salaire > 0) {
            const moisSup = (mois13 ? 1 : 0) + (mois14 ? 1 : 0);
            const val = Math.round(salaire * moisSup);
            chartLabels.push(
              `${moisSup} mois supplémentaire${moisSup > 1 ? "s" : ""}`
            );
            chartData.push(val);
            chartColors.push("#FACC15"); // jaune
          }

          // 💾 Supprimer l'ancien graphique s'il existe
          if (window.avantageChart) {
            window.avantageChart.destroy();
          }

          const ctx = document
            .getElementById("avantagesChart")
            .getContext("2d");
          window.avantageChart = new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: chartLabels,
              datasets: [
                {
                  data: chartData,
                  backgroundColor: chartColors,
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: "bottom",
                },
                tooltip: {
                  callbacks: {
                    label: (context) =>
                      ` ${context.label}: ${context.formattedValue} €`,
                  },
                },
              },
              animation: {
                animateScale: true,
                animateRotate: true,
              },
            },
          });
        }

        // 🔁 Rafraîchir au changement
        document
          .querySelectorAll("input")
          .forEach((el) => el.addEventListener("input", calculAvantages));
      </script>
    </main>

    <script>
      const checkboxes = document.querySelectorAll(".avantage");
      const cardsContainer = document.getElementById("cardsContainer");
      const totalOutput = document.getElementById("total");
      const recapBox = document.getElementById("recap");

      checkboxes.forEach((box) => {
        box.addEventListener("change", () => {
          cardsContainer.innerHTML = "";
          let total = 0;

          checkboxes.forEach((cb) => {
            if (cb.checked) {
              const val = parseInt(cb.value);
              total += val;

              const card = document.createElement("div");
              card.className =
                "bg-blue-50 text-blue-800 rounded-xl p-6 shadow-md text-center hover:scale-[1.02] transition-all";
              card.innerHTML = `<p class="text-sm font-semibold">+${val.toLocaleString(
                "fr-FR"
              )} €</p>`;
              cardsContainer.appendChild(card);
            }
          });

          if (total > 0) {
            recapBox.classList.remove("hidden");
            totalOutput.textContent = total.toLocaleString("fr-FR") + " €";
          } else {
            recapBox.classList.add("hidden");
            totalOutput.textContent = "-- €";
          }
        });
      });
    </script>

    <footer class="text-center text-xs text-gray-400 mt-12 pb-5">
      © 2025 Simulateur d’avantages sociaux – Estimations à titre indicatif.
    </footer>
  </body>
</html>
